// Dir is https://drive.google.com/drive/folders/1u8ZUAkLc8yZBwGgXvfBcAY_oSCyzT_pp
//
//

::: columns
:::: {.column width=15%}
![](data605/lectures_source/images/UMD_Logo.png)
::::
:::: {.column width=75%}

\vspace{0.4cm}
\begingroup \large
UMD DATA605 - Big Data Systems
\endgroup
::::
:::

\vspace{1cm}

\begingroup \Large
**$$\text{\blue{11.2: AWS Overview}}$$**
\endgroup

::: columns
:::: {.column width=75%}
- **Instructor**: Dr. GP Saggese, [gsaggese@umd.edu](gsaggese@umd.edu)

- **References**:
  - Some basic info in the slides
  - Many tutorials on-line
  - Mastery
    - "Amazon Web Services in Action" 3rd Edition
::::
:::: {.column width=20%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_2_image_1.png)
::::
:::

* Amazon Web Services (AWS)
- **AWS is a platform offering complete cloud solutions**
  - Computing (e.g., EC2)
  - Storing (e.g., S3)
  - Networking

- **Offers different levels of abstractions**
  - IaaS, PaaS, SaaS
  - From virtual hardware to applications, e.g.,
    - Host websites
    - Run enterprise software
    - Run machine learning applications

- **Control services in different ways**
  - Web interface (console)
  - CLI: `aws` command
  - Language libraries, SDK (e.g., Python `boto3`)

* AWS as Business
::: columns
:::: {.column width=50%}
- Services charge pay-per-use pricing model
  - 500 new services and features annually

- Data centers distributed globally
  - US, Europe, Asia, South America

- Insanely profitable
  - $91B/year in revenue (2023)
  - Grows 42% year-over-year
  - Controls 30% of cloud business

::::
:::: {.column width=45%}
\center \small

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_4_image_1.png)

_Beef Jezos_

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_4_image_2.png)
::::
:::

* Types of Cloud Computing
- Cloud computing enables a **shared pool of configurable computing resources**
  - E.g., servers, storage, networks, applications, services
  - Accessible from anywhere
  - Convenient
  - On-demand

- Clouds can be:
  - _Public_: open to the general public (e.g., AWS)
  - _Private_: virtualize and share IT infrastructure within one organization
    (e.g., government)
  - _Hybrid_: mix of public and private clouds

* AWS vs Google Cloud vs Microsoft Azure
::: columns
:::: {.column width=60%}
- **Similarities:**
  - Worldwide infrastructure
  - Provide IaaS (computing, networking, storage)
    - AWS EC2 / Google Compute Engine / Azure VMs
    - AWS S3 / Google Cloud Storage / Azure Blob Storage
  - Pay-as-you-go pricing model

- **Differences:**
  - AWS
    - Market leader, mature, powerful
    - Utilizes open source technologies
  - Azure
    - Offers Microsoft stack in the cloud
  - Google
    - Focuses on cloud-native applications

::::
:::: {.column width=35%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_6_image_2.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_6_image_3.png)
::::
:::

* From On-premise to AWS: 1/3
- Aka "Cloud-transformation"

- **Example**: move a medium-sized e-commerce site _from on-premise to the cloud_

::: columns
:::: {.column width=45%}
- **No-cloud**
  - _Web-server_: handles customer requests
  - _DB_: stores product info and orders
  - _Static content_ (e.g., JPEG images)
    - Delivered over CDN
    - Reduces load on services
  - _Dynamic content_ (e.g., HTML pages)
    - E.g., products and prices
    - Delivered by web server
::::
:::: {.column width=50%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_8_image_1.png)
::::
:::

* From On-premise to AWS: 2/3

::: columns
:::: {.column width=45%}
- **Move to cloud**
  - Keep the same architecture
  - Move components to cloud

::::
:::: {.column width=50%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_8_image_1.png)
::::
:::

* From On-premise to AWS: 3/3
::: columns
:::: {.column width=45%}
- **Design for the cloud**
  - DNS
  - Database
  - Object store (S3)
  - Managed solutions
  - Use multiple smaller virtual services with a load balancer to increase
    reliability

::::
:::: {.column width=50%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_9_image_1.png)
::::
:::

* Capacity Scaling
::: columns
:::: {.column width=50%}
- **No need to plan for capacity**
  - Do not predict capacity
  - Schedule capacity on-the-fly
  - No concern for rack space, switches, power supplies
  - Add more VMs (1 to 1000) and storage (GB to PB) as needed

- **Handle seasonal traffic by scaling up/down**
  - Day vs night
  - Weekday vs weekend
  - Holidays
  - No test system needed when the team is off
::::
:::: {.column width=45%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_11_image_1.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_11_image_2.png)
::::
:::

- **Worldwide presence**
  - AWS has many data centers
  - Deploy applications close to customers

* Pay-per-use
::: columns
:::: {.column width=50%}
- **AWS bill**
  - Similar to an electric bill
  - Services billed based on usage:
    - Hours of virtual server (rounded up)
    - Used storage in GB (allocated or real)
    - Data traffic in GB or requests
    - ...
::::
:::: {.column width=45%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_12_image_1.png)
::::
:::

- **Free tier**
  - Use some AWS services free for 12 months after signing up
  - Experiment with services
    - E.g., EC2, S3
  - Exceed limits, start paying (without notice)
    - Set an alarm!

* Pay-per-use
::: columns
:::: {.column width=55%}
- **Advantages**
  - No upfront investments or commitment
  - Lower project startup cost
  - Easier to divide the system into smaller parts
    - One big server or two smaller ones cost the same
  - Affordable fault tolerance/high performance
    - For a scalable workload "buy 1 server for 1000 hours" = "buy 1000 servers
      for 1 hour"
::::
:::: {.column width=40%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_13_image_1.png)

::::
:::

* Interacting with AWS
::: columns
:::: {.column width=55%}
- **GUI (Management Console)**
  - Start interacting with services easily
  - Set up cloud infrastructure for development and testing

- **Command-line tool (CLI)**
  - Manage and access AWS services
  - Automate recurring tasks

- **SDKs**
  - Use libraries in any language to interact with AWS
  - Integrate applications with AWS
  - E.g., `boto3` for Python

- **Blueprints**
  - Describe your system with all services and dependencies
  - Describe the system, not how to build it
::::
:::: {.column width=40%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_14_image_3.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_14_image_2.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_14_image_1.png)
::::
:::

* Accounts and Users
::: columns
:::: {.column width=55%}
- **Users**
  - One root AWS account
  - Attach multiple users to an account
    - Different privileges
    - Isolate workloads

- **Be safe**
  - Never use root account to develop
  - Always use 2FA
  - Avoid costly mistakes

- **Key pair**
  - Create a key pair to access a virtual server
  - Public key (in AWS and on virtual servers)
  - Private key is your secret
    - Don't lose it; can't retrieve it
::::
:::: {.column width=40%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_15_image_1.png)
::::
:::

* Create User Account
::: columns
:::: {.column width=40%}
- **Create a new user**
  - Do not use AWS root account for development
  - IAM: Identity and Access Management
  - Access key ID + secret access key

- **Access control**
  - Enable programmatic access
  - Enable console access
  - Limit user actions through policies
::::
:::: {.column width=55%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_29_image_2.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_29_image_3.png)
::::
:::

* AWS VMs
::: columns
:::: {.column width=55%}
- **With virtualization**
  - Multiple VMs run on the same hardware
  - Start and stop VMs on-demand

- **Physical server**
  - Aka "host machine", "bare metal"
  - Consists of CPUs, memory, networking interfaces, storage

- **Hypervisor**
  - Software + CPU hardware
  - Isolates guests
  - Schedules hardware requests

- AWS
  - Before Xen hypervisor (open-source)
  - Switched to AWS Nitro
    - Hardware-assisted virtualization
    - Performance close to bare metal

- **Virtual servers**
  - Isolated on the same hardware
::::
:::: {.column width=40%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_16_image_1.png)
::::
:::

* Select Region
::: columns
:::: {.column width=55%}
- E.g., `us-east-1`
  - 21155 Smith Switch Road, Ashburn, VA, USA

\vspace{0.2cm}
\center

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_17_image_2.png){width=80%}

- Major internet backbone in Ashburn, VA
  - Equinix
  - Digital Realty
  - Vantage Data Centers
  - H5 Data Centers
  - ...
::::
:::: {.column width=40%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_17_image_1.png){width=80%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_17_image_3.png){width=80%}
::::
:::

* Starting an EC2 Instance
::: columns
:::: {.column width=55%}
- **Select OS**
  - Amazon Machine Image (AMI)
  - Contains OS + pre-installed software
  - Saves time installing OS, packages, software

- **Choose instance parameters**
  - E.g., `t2.micro`
  - More info later

- **Configure instance**
  - Network, shutdown behavior, termination protection, monitoring

::::
:::: {.column width=40%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_18_image_1.png){width=90%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_18_image_3.png){width=90%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_18_image_2.png){width=90%}

::::
:::

* AWS Instance Type
::: columns
:::: {.column width=50%}
- **Instance type** describes the computing power

- **Instance family**
  - `T`: cheap, baseline
  - `M`: general purpose
  - `C`: compute optimized
  - `R`: memory optimized
  - `D`: storage optimized for HDD
  - `I`: storage optimized for SSD
  - `F`: with FPGAs
  - `P, G, CG`: with GPUs

- [AWS EC2 list](https://aws.amazon.com/ec2/instance-types)
::::
:::: {.column width=45%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_19_image_1.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_19_image_2.png)

- E.g., `t2.micro`
  - `t`: instance family (small, cheap)
  - `2`: generation (second)
  - `micro`: size (1 vCPU, 1GB memory)
  - 0.013 USD/hr

- E.g., `m4.large`
  - `m`: general purpose
  - `large`: size (2 vCPUs, 8GB memory)
  - 0.14 USD/hr
::::
:::

* AWS Instance Type
- Price on AWS website is somehow unclear (duh really?)
  - Burst mode
  - vCPUs
  - Multi-tenancy
  - On-demand vs spot vs reserved vs pre-paid

- 642 types of EC2 machines (as of 2023)
  - Cheapest: 37 USD/yr
  - Most expensive: 1.91M USD/yr (500 CPUs and 24TB of memory)

- [Alternative sites](https://instances.vantage.sh) tracking prices

* Starting an EC2 Instance
::: columns
:::: {.column width=45%}
- Add storage
  - Volume size
  - Volume type (SSD or magnetic HDDs)
- Tag
- Configure firewall
  - How to access using SSH
  - Select key-pair
- How to monitor the instance
  - E.g. CloudWatch
::::
:::: {.column width=50%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_21_image_1.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_21_image_2.png)
::::
:::

* Starting an EC2 Instance
::: columns
:::: {.column width=45%}
- Start instance
- Find public IP
::::
:::: {.column width=50%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_22_image_1.png)
::::
:::
- Connect to the machine
  \small
  ```bash
  > ssh -i $PATH/mykey.pem ubuntu@$PUBLIC_UP
  > cat /proc/cpuinfo
  > free -m
  > sudo apt-get update
  > sudo apt-get install ...
  ```

* States of a VM
- **Start**
  - Start stopped VM

- **Stop**
  - Stopped VM not billed
  - Network HDD persist and incur charges
  - Local disk does not persist
  - VM can restart on a different host (different IP)

::: columns
:::: {.column width=45%}

- **Reboot**
  - Network HDD persist
  - Local disk does not persist
  - Software remains installed
  - VM restarts on a different host

- **Terminate**
  - Delete: cannot restart
  - Network HDD persist
  - Local disk wiped out
::::
:::: {.column width=50%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_23_image_1.png)
::::
:::

* Moving / Upgrading EC2 Instances
- **Scale up / down**
  - Increase VM size for more computing power
  - Stop VM
  - Change instance type (e.g., `m3.large`)
  - Start VM
  - IP addresses change

- **AWS regions**
  - Regions are collections of data centers
  - Regions are independent
  - No data transfer across regions
  - Some services (e.g., IAM, CDN, DNS) are global

- **Why move across AWS regions**
  - Proximity to users
  - Compliance
    - Data storage and processing permissions
  - Service availability
    - Some services unavailable in certain regions
  - Redundancy
  - Costs
    - Vary by region

* Optimizing Costs
- **On-demand instances**
  - Maximum flexibility, no restrictions
  - Start and stop VMs anytime
  - Pay by hour

- **EC2 / Compute saving plans**
  - 1 yr vs 3 yrs
  - Commit to a certain number of hours
  - Payment options: all, partial, no upfront
  - Discount: up to 3x cheaper than on-demand
  - Useful for dev servers

- **Capacity reservation**
  - Access machines even in peak hours

- **Spot instances**
  - Bid for unused capacity
  - Price based on supply/demand
  - Discount: up to 10x cheaper than on-demand
  - Useful for asynchronous tasks

* Low-Cost Processing
- Lots of batch jobs are not critical / run on a schedule
  - Analyze data daily
  - Generate reports from a database

1) **Allocate machines on demand**
   - AWS bills VMs per minute
   - Pay only when running jobs

2) **AWS Batch**
   - Offers spare capacity at a discount
   - Runs when capacity is available, saving 50%

3) **AWS Lambda**
   - Serverless

* Programming the Infrastructure
::: columns
:::: {.column width=45%}
- On AWS everything can be **controlled via an API**
  - Start a VM
  - Create 1TB of storage
  - Start Hadoop cluster
  -

- Use:
  - AWS GUI console
  - HTTP requests to API
  - CLI (Command Line Interface)
    - Call AWS API from terminal
  - SDK (Software Development Kit)
    - Call AWS API from code
  - CloudFormation: templates describe infrastructure state, translated into API
    calls
::::
:::: {.column width=50%}
![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_26_image_1.png)

- **Jeff Bezos 2002 API mandate**
  - An email worth $100B/yr
::::
:::

* Infrastructure-as-Code
- Use high-level **programming language to control IT systems**

- Apply **software development principles to infrastructure**
  - Code repository
  - Automated tests
  - Continuous integration

- **DevOps (SRE in Google parlance)**
  - Mix developers and operations in the same team
  - Use software to bring development and operations closer
  - Switch roles to experience each other's pain
    - Devs $\to$ responsible for operational tasks (e.g., on-call)
    - Ops $\to$ involved in software development, making system easier to
      operate
  - Foster communication and collaboration

* Infrastructure-as-Code: Advantages
::: columns
:::: {.column width=55%}
- **Save time**
  - Reuse scripts or blueprints
  - Automate tasks
  - Copy-paste vs click-click-click

- **Fewer mistakes**
  - Push-button flow

- **Consistency of actions**
  - Multiple deployments per day

- **Deployment pipeline**
  - Commit changes to source code
  - Build application from source
  - Automatic tests (e.g., integration tests)
  - Build testing environment
  - Run acceptance tests in isolation
  - Propagate changes to production

- **Script as detailed documentation**
  - Explains what and how, not why
::::
:::: {.column width=40%}
![](data605/lectures_source/images/lecture_11_2/lec_11_3_slide_15_image_1.png)

![](data605/lectures_source/images/lecture_11_2/lec_11_3_slide_15_image_2.png)
::::
:::

* AWS Command Line Interface (CLI)
- Provide **unified interface** to all AWS services
  - Output is in JSON format
  ```bash
  > apt-get install awscli
  ```

- **Authenticate**
  ```
  > aws configure
  ```
  - AWS access key ID
    - E.g., `AKIAIR...D7ZCA`
  - AWS secret access key
    - E.g., `SSKIng7jkA...enqBj7`
  - Default region name
    - E.g., `us-east-1`

- **Execute command**
  ```
  > aws <service> <action> --key value
  ```

* Software Development Kit (SDK)
::: columns
:::: {.column width=60%}
- **SDK is a library calling AWS API** from your programming language
  - E.g., Python, Go, C++, JavaScript

- **Pros**: it handles
  - Authentication
  - Retry on error
  - HTTPS communication
  - XML / JSON de-/serialization

- **Cons**
  - Imperative approach
  - Deal with dependencies

::::
:::: {.column width=35%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_31_image_1.png)
::::
:::

* AWS CloudFormation
- **Use templates to describe infrastructure**
  - E.g., JSON, YAML

- **Declarative vs imperative approach**
  - Declare the system, not the steps to build it

- **AWS Stacks** processes CloudFormation templates

- **Pros**
  - Consistent infrastructure description
  - Handle dependencies
  - Customizable
    - Inject parameters to customize templates
  - Testable
    - Create infra from a template, test, shut down
  - Updatable
    - Update template, Stacks applies changes automatically
  - Serves as documentation
    - Use as code in source control

* Securing Your System
::: columns
:::: {.column width=50%}
- **Always install software updates**
  - Fix security vulnerabilities daily

- **Restrict access to AWS account**
  - Use different AWS accounts for individuals and scripts
  - Apply "least privilege": grant necessary permissions only

- **Restrict network traffic**
  - Open essential ports
    - E.g., 80 for HTTP, 443 for HTTPS
  - Close others
  - Encrypt traffic and data

- **Create a private network**
  - Use subnets not reachable from the Internet
::::
:::: {.column width=45%}

![](data605/lectures_source/images/lecture_11_2/lec_11_2_slide_33_image_1.png)
::::
:::

* AWS Shared-responsibility Principle
- **AWS is responsible for**:
  - Protecting network by monitoring Internet access
    - Preventing DDoS attacks
  - Ensuring physical security of data centers
  - Decommissioning storage devices after end of life

- **You are responsible for**:
  - Restricting access using IAM
  - Encrypting network traffic (e.g., HTTPS)
  - Configuring firewall for VPN
  - Encrypting data
  - Updating OS and software
